<?xml version="1.0"?>
<!-- @(#)STI-FLO_Topology.xsd
Copyright (c) systransis Ltd.
All rights reserved.
-->

<xs:schema version="1.0"
           xmlns:xs="http://www.w3.org/2001/XMLSchema"
           elementFormDefault="qualified">
    <!-- attribute type declarations -->
    <xs:simpleType name="TrackElementOrientationEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="left"/>
            <xs:enumeration value="right"/>
            <xs:enumeration value="none"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="VertexDirectionEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="left"/>
            <xs:enumeration value="right"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="SwitchPositionEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="left"/>
            <xs:enumeration value="right"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="SperreDirectionEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="independent"/>
            <xs:enumeration value="left"/>
            <xs:enumeration value="right"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="InitialStateEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="unknown"/>
            <xs:enumeration value="noProblem"/>
        </xs:restriction>
    </xs:simpleType>

    <!-- root element -->
    <xs:element name="ProcessImageConfig">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="GSMRCells"/>
                <xs:element ref="GSMRVoiceRoles"/>
                <xs:element ref="GSMRVoiceText"/>
                <xs:element ref="OppositeEdges"/>
                <xs:element ref="PBPs"/>
                <xs:element ref="Regions"/>
                <xs:element ref="Sections"/>
                <xs:element ref="SensedAreaPaths"/>
                <xs:element ref="Sperren"/>
                <xs:element ref="States"/>
                <xs:element ref="StaticSpeedProfile"/>
                <xs:element ref="StoppingLocations"/>
                <xs:element ref="Tracks"/>
                <xs:element ref="Tunnels"/>
                <xs:element ref="TunnelDoorPosition"/>
                <xs:element ref="TunnelPosition"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="version" use="required"/>
        </xs:complexType>

        <!-- uniqueness requirements -->
        <xs:unique name="unique-Edge-id">
            <xs:selector xpath=".//Edge"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-TrackElement-id">
            <xs:selector xpath=".//TrackElement"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-Vertex-signal">
            <xs:selector xpath=".//Vertex"/>
            <xs:field xpath="@signal"/>
        </xs:unique>
        <xs:unique name="unique-Sperre-id">
            <xs:selector xpath=".//Sperre"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-Tunnel-id">
            <xs:selector xpath=".//Tunnel"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-MaintenanceRegion-id">
            <xs:selector xpath=".//MaintenanceRegion"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-PowerSupplyRegion-id">
            <xs:selector xpath=".//PowerSupplyRegion"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-NamedRegion-id">
            <xs:selector xpath=".//NamedRegion"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-BaliseGroup-id">
            <xs:selector xpath=".//BaliseGroup"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-OptionalNeutralSection-id">
            <xs:selector xpath=".//OptionalNeutralSection"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-StoppingLocation-id">
            <xs:selector xpath=".//StoppingLocation"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-GSMRCell-id">
            <xs:selector xpath=".//GSMRCell"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-GSMRVoiceReferenceText-id">
            <xs:selector xpath=".//GSMRVoiceReferenceText"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-TunnelDoorPosition-id">
            <xs:selector xpath=".//TunnelDoorPosition"/>
            <xs:field xpath="@id"/>
        </xs:unique>
        <xs:unique name="unique-PBP-id">
            <xs:selector xpath=".//PBP"/>
            <xs:field xpath="@id"/>
        </xs:unique>
    </xs:element>

    <!-- Children of root -->
    <xs:element name="Tracks">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="BaliseGroup"/>
                <xs:element ref="TrackElement"/>
                <xs:element ref="TrackElementSlope"/>
                <xs:element ref="VertexPosition"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="GSMRCells">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="GSMRCell"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="GSMRVoiceText">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="GSMRVoiceReferenceText"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="GSMRVoiceRoles">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="GSMRVoiceRole"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="OppositeEdges">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="OppositeEdge"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="PBPs">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="PBP"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Tunnels">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Tunnel"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Regions">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="MaintenanceRegion"/>
                <xs:element ref="NamedRegion"/>
                <xs:element ref="PowerSupplyRegion"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Sections">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="OptionalNeutralSection"/>
                <xs:element ref="TrackEdge"/>
            </xs:choice>
            <xs:attribute type="xs:boolean" name="useRbc2TrackEdges" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="SensedAreaPaths">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Path"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Sperren">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="Sperre"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
    <xs:element name="States">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="State"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="StoppingLocations">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="StoppingLocation"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="StaticSpeedProfile">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="EdgeSpeed"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>

    <!-- BaliseGroup and its child elements -->
    <xs:element name="BaliseGroup">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="position" use="required"/>
            <xs:attribute type="xs:string" name="edge" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- TrackElement and its child elements -->
    <xs:element name="TrackElement">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="Edge"/>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="Vertex"/>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="ZnFieldEntry"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="TrackElementOrientationEnum" name="orientation" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="ConnectingVertex">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Edge">
        <xs:complexType>
            <xs:choice maxOccurs="1" minOccurs="0">
                <xs:element ref="Position"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Position">
        <xs:complexType>
            <xs:attribute type="SwitchPositionEnum" name="direction" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Vertex">
        <xs:complexType>
            <xs:sequence>
                <xs:element minOccurs="0" ref="Signal"/>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="TrackEdge"/>
                <xs:element minOccurs="0" ref="ConnectingVertex"/>
            </xs:sequence>
            <xs:attribute type="VertexDirectionEnum" name="direction" use="required"/>
            <xs:attribute type="xs:string" name="signal" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Signal">
        <xs:complexType>
            <xs:attribute type="xs:string" name="alias" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="ZnFieldEntry">
        <xs:complexType>
            <xs:attribute type="xs:string" name="fromVertex" use="required"/>
            <xs:attribute type="xs:string" name="entryVertex" use="optional"/>
        </xs:complexType>
    </xs:element>

    <!-- Tunnel and its child elements -->
    <xs:element name="Tunnel">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="SlidingDoorGroup"/>
                <xs:element ref="TunnelDoor"/>
                <xs:element ref="EndingTrack"/>
                <xs:element ref="StartingTrack"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="SlidingDoorGroup">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:string" name="trackid" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="TunnelDoor">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:string" name="trackid" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="EndingTrack">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="StartingTrack">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- EdgeSpeed and its child elements -->
    <xs:element name="EdgeSpeed">
        <xs:complexType>
            <xs:attribute type="xs:string" name="edgeid" use="required"/>
            <xs:attribute type="xs:integer" name="position" use="required"/>
            <xs:attribute type="xs:string" name="leftspeed" use="required"/>
            <xs:attribute type="xs:string" name="rightspeed" use="required"/>
        </xs:complexType>
    </xs:element>

    <!--GSMRCell and its child elements -->
    <xs:element name="GSMRCell">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="GSMRCellEdge"/>
                <xs:element ref="GSMRCellBorderBlocker"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="InitialStateEnum" name="initialState" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="GSMRCellEdge">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="GSMRCellBorderBlocker">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <!--GSMRVoiceReferenceText and its child elements -->
    <xs:element name="GSMRVoiceReferenceText">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:string" name="text" use="required"/>
        </xs:complexType>
    </xs:element>
    <!--GSMRVoiceRole and its child elements -->
    <xs:element name="GSMRVoiceRole">
        <xs:complexType>
            <xs:attribute type="xs:string" name="afcIp" use="required"/>
            <xs:attribute type="xs:string" name="roleId" use="required"/>
        </xs:complexType>
    </xs:element>


    <!-- MaintenanceRegion and its child elements-->
    <xs:element name="MaintenanceRegion">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="TrackPath"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="TrackPath">
        <xs:complexType>
            <xs:attribute type="xs:string" name="starttrack" use="required"/>
            <xs:attribute type="xs:string" name="endtrack" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- PowerSupplyRegion and its child elements-->
    <xs:element name="PowerSupplyRegion">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="TrackPath"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- NamedRegion and its child elements-->
    <xs:element name="NamedRegion">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="TrackPath"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- OptionalNeutralSection and its child elements-->
    <xs:element name="OptionalNeutralSection">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="1" minOccurs="1" ref="Starting"/>
                <xs:element maxOccurs="1" minOccurs="1" ref="Ending"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Starting">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="startposition" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Ending">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="endposition" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- TrackEdge occurs both in TrackElement and as a section-->
    <xs:element name="TrackEdge">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Starting"/>
                <xs:element ref="Ending"/>
                <xs:element ref="Via"/>
                <xs:element ref="Alias"/>
                <xs:element ref="KmSprung"/>
                <xs:element ref="Connector"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Alias">
        <xs:complexType>
            <xs:attribute type="xs:string" name="alias" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Via">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="KmSprung">
        <xs:complexType>
            <xs:attribute type="xs:integer" name="offset" use="required"/>
            <xs:attribute type="xs:integer" name="startingAt" use="optional"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Connector">
        <xs:complexType>
            <xs:attribute type="xs:integer" name="operationalKM1" use="required"/>
            <xs:attribute type="xs:integer" name="operationalKM2" use="required"/>
        </xs:complexType>
    </xs:element>


    <!-- StoppingLocation and its child elements -->
    <xs:element name="StoppingLocation">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" minOccurs="0" ref="TrackId"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="center" use="required"/>
            <xs:attribute type="xs:boolean" name="announcetoOBU" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="TrackId">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:string" name="station" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- State and its child elements -->
    <xs:element name="State">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="InitialStateEnum" name="initialState" use="required"/>
        </xs:complexType>
    </xs:element>
    <!-- Path and its child elements -->
    <xs:element name="Path">
        <xs:complexType>
            <xs:attribute type="xs:string" name="from" use="required"/>
            <xs:attribute type="xs:string" name="to" use="required"/>
            <xs:attribute type="xs:string" name="via" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- Sperre and its child elements -->
    <xs:element name="Sperre">
        <xs:complexType>
            <xs:attribute type="SperreDirectionEnum" name="direction" use="required"/>
            <xs:attribute type="xs:string" name="edgeid" use="required"/>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>


    <!-- TrackElementSlope and its child elements -->
    <xs:element name="TrackElementSlope">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:double" name="slope" use="required"/>
        </xs:complexType>
    </xs:element>


    <!-- TunnelDoorPosition and its child elements -->
    <xs:element name="TunnelDoorPosition">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="position" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- TunnelPosition and its child elements -->
    <xs:element name="TunnelPosition">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Starting"/>
                <xs:element ref="Ending"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="id" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- OppositeEdge and its child elements -->
    <xs:element name="OppositeEdge">
        <xs:complexType>
            <xs:attribute type="xs:string" name="edgeid" use="required"/>
            <xs:attribute type="xs:string" name="oppositeid" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- PBP (PredictionBetriebsPunkt) and its child elements -->
    <xs:element name="PBP">
        <xs:complexType>
            <xs:attribute type="xs:string" name="id" use="required"/>
            <xs:attribute type="xs:integer" name="position" use="required"/>
            <xs:attribute type="xs:string" name="tracks" use="required"/>
        </xs:complexType>
    </xs:element>

    <!-- VertexPosition and its child elements -->
    <xs:element name="VertexPosition">
        <xs:complexType>
            <xs:attribute type="xs:string" name="signal" use="required"/>
            <xs:attribute type="xs:integer" name="position" use="required"/>
            <xs:attribute type="xs:integer" name="offset" use="optional"/>
        </xs:complexType>
    </xs:element>
</xs:schema>
