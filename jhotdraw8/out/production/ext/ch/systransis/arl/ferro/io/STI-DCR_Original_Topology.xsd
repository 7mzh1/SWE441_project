<?xml version="1.0"?>
<!-- @(#)STI-DCR_Topology.xsd
Copyright (c) systransis Ltd.
All rights reserved.
-->

<xs:schema version="1.0"
           xmlns:xs="http://www.w3.org/2001/XMLSchema"
           elementFormDefault="qualified">
    <!-- attribute type declarations -->
    <xs:simpleType name="PIOLocationDescTypeEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="Mileage"/>
            <xs:enumeration value="Location"/>
            <xs:enumeration value="Vertex"/>
            <xs:enumeration value="Object"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="PIOPathDescTypeEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="Mileage"/>
            <xs:enumeration value="Location"/>
            <xs:enumeration value="Vertex"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="PathAttrNameEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="Orientation"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="MileageOrientationEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="Downwards"/>
            <xs:enumeration value="Upwards"/>
        </xs:restriction>
    </xs:simpleType>
    <xs:simpleType name="RouteTypeEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="POSA"/>
            <xs:enumeration value="MAIN"/>
            <xs:enumeration value="SHUNT"/>
            <xs:enumeration value="CALLON"/>
            <xs:enumeration value="AUTO"/>
            <xs:enumeration value="WARNER"/>
        </xs:restriction>
    </xs:simpleType>

    <!-- root element -->
    <xs:element name="ProcessImageConfig">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Berths"/>
                <xs:element ref="Geolocations"/>
                <xs:element ref="Links"/>
                <xs:element ref="MainSignals"/>
                <xs:element ref="Mileages"/>
                <xs:element ref="Routes"/>
                <xs:element ref="SafetyElements"/>
                <xs:element ref="Sections"/>
                <xs:element ref="StaticSpeedProfile"/>
                <xs:element ref="Stations"/>
                <xs:element ref="Switches"/>
                <xs:element ref="TimingPoints"/>
                <xs:element ref="Topology"/>
                <xs:element ref="ZNFields"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="version" use="optional"/>
        </xs:complexType>

        <!-- uniqueness requirements -->
        <xs:unique name="unique-Alias-namespace-name">
            <xs:selector xpath=".//Alias"/>
            <xs:field xpath="@nameSpace"/>
            <xs:field xpath="@otherName"/>
        </xs:unique>
        <xs:unique name="unique-Berth-name">
            <xs:selector xpath=".//Berth"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Link-name">
            <xs:selector xpath=".//Link"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-MainSignal-name">
            <xs:selector xpath=".//MainSignal"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Mileage-name">
            <xs:selector xpath=".//Mileage"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Route-name">
            <xs:selector xpath=".//Route"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-SafetyElement-name">
            <xs:selector xpath=".//SafetyElement"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-SpeedLimitArea-name">
            <xs:selector xpath=".//SpeedLimitArea"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-TimingPoint-name">
            <xs:selector xpath=".//TimingPoint"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Section-name">
            <xs:selector xpath=".//Section"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Station-name">
            <xs:selector xpath=".//Station"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-Switch-name">
            <xs:selector xpath=".//Switch"/>
            <xs:field xpath="@name"/>
        </xs:unique>
        <xs:unique name="unique-ZNField-name">
            <xs:selector xpath=".//ZNField"/>
            <xs:field xpath="@name"/>
        </xs:unique>
    </xs:element>

    <!-- Children of root -->
    <xs:element name="Berths">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Berth"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Geolocations">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="VertexGeolocation"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Links">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Link"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="MainSignals">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="MainSignal"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Mileages">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Mileage"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Routes">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Route"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="SafetyElements">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="SafetyElement"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Sections">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Section"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="StaticSpeedProfile">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="SpeedLimitArea"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Stations">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Station"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Switches">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Switch"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="TimingPoints">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="TimingPoint"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Topology">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Twin"/>
                <xs:element ref="Segment"/>
                <xs:element ref="Border"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="ZNFields">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="ZNField"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>

    <!-- Twin, Segment and Vertex -->
    <xs:element name="Twin">
        <xs:complexType>
            <xs:choice maxOccurs="2" minOccurs="2">
                <xs:element ref="Vertex"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Segment">
        <xs:complexType>
            <xs:choice maxOccurs="2" minOccurs="2">
                <xs:element ref="Vertex"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
    <xs:element name="Vertex">
        <xs:complexType>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Border">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="Vertex"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>


    <!-- Mileage and its child elements -->
    <xs:element name="Mileage">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Anchor"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
        <xs:unique name="unique-AnchorInMileage">
            <xs:selector xpath="Mileage/Anchor"/>
            <xs:field xpath="@vertexName"/>
        </xs:unique>
    </xs:element>
    <xs:element name="Anchor">
        <xs:complexType>
            <xs:attribute type="xs:integer" name="pos" use="required"/>
            <xs:attribute type="xs:string" name="vertexName" use="required"/>
            <xs:attribute type="MileageOrientationEnum" name="orientation" use="required"/>
        </xs:complexType>
    </xs:element>
    <!-- Objects and child elements -->
    <xs:element name="Berth">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Link">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOLocation"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="MainSignal">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOLocation"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Route">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
            <xs:attribute type="RouteTypeEnum" name="type" use="optional"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="SafetyElement">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Section">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
            <xs:attribute type="xs:boolean" name="inferOrder" use="optional"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Station">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOLocation"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Switch">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="TimingPoint">
        <xs:complexType>
            <xs:sequence>
                <xs:element ref="Alias" maxOccurs="unbounded" minOccurs="0"/>
                <xs:element ref="PIOLocation" maxOccurs="1" minOccurs="1"/>
            </xs:sequence>
            <xs:attribute type="xs:string" name="name" use="required"/>
            <xs:attribute type="xs:boolean" name="stoppingAllowed" use="required"/>
            <xs:attribute type="xs:boolean" name="splitSection" use="optional"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="VertexGeolocation">
        <xs:complexType>
            <xs:attribute type="xs:string" name="name" use="optional"/>
            <xs:attribute type="xs:string" name="vertex" use="required"/>
            <xs:attribute type="xs:decimal" name="longitude" use="required"/>
            <xs:attribute type="xs:decimal" name="latitude" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="ZNField">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Alias"/>
                <xs:element ref="PIOPath"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
        </xs:complexType>
    </xs:element>
    <!-- Child elements of Objects -->
    <xs:element name="Alias">
        <xs:complexType>
            <xs:attribute type="xs:string" name="otherName" use="required"/>
            <xs:attribute type="xs:string" name="nameSpace" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="PIOLocation">
        <xs:complexType>
            <xs:choice maxOccurs="1" minOccurs="1">
                <xs:element ref="Waypoint"/>
            </xs:choice>
            <xs:attribute type="PIOLocationDescTypeEnum" name="descType" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="PIOPath">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="Waypoint"/>
                <xs:element ref="PathAttr"/>
            </xs:choice>
            <xs:attribute type="PIOPathDescTypeEnum" name="descType" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="Waypoint">
        <xs:complexType>
            <xs:attribute type="xs:string" name="firstVertex" use="optional"/>
            <xs:attribute type="xs:string" name="secondVertex" use="optional"/>
            <xs:attribute type="xs:integer" name="distance" use="optional"/>
            <xs:attribute type="xs:string" name="desc" use="optional"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="PathAttr">
        <xs:complexType>
            <xs:attribute type="PathAttrNameEnum" name="name" use="required"/>
            <xs:attribute type="xs:string" name="value" use="required"/>
        </xs:complexType>
    </xs:element>
    <!-- SpeedLimitArea and its child elements -->
    <xs:element name="SpeedLimitArea">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="1">
                <xs:element ref="PIOPath"/>
                <xs:element ref="SpeedLimitCategory"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="name" use="required"/>
            <xs:attribute type="xs:integer" name="defaultSpeed" use="required"/>
            <xs:attribute type="xs:boolean" name="isDirected" use="required"/>
        </xs:complexType>
    </xs:element>
    <xs:element name="SpeedLimitCategory">
        <xs:complexType>
            <xs:attribute type="xs:string" name="category" use="required"/>
            <xs:attribute type="xs:integer" name="speed" use="required"/>
        </xs:complexType>
    </xs:element>
</xs:schema>
