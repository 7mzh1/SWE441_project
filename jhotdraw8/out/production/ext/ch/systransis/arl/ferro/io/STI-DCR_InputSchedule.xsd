<?xml version="1.0"?>
<!-- @(#)STI-DCR_Topology.xsd
Copyright (c) systransis Ltd.
All rights reserved.
-->

<xs:schema version="1.0"
           xmlns:xs="http://www.w3.org/2001/XMLSchema"
           elementFormDefault="qualified">
    <!-- attribute type declarations -->
    <xs:simpleType name="TrainClassEnum">
        <xs:restriction base="xs:string">
            <xs:enumeration value="PASSENGER_TRAIN"/>
            <xs:enumeration value="RAIL"/>
            <xs:enumeration value="EXTRAZUG"/>
            <xs:enumeration value="SCHNELLZUG"/>
            <xs:enumeration value="INTERREGIO"/>
            <xs:enumeration value="NACHTZUG"/>
            <xs:enumeration value="REGIONALZUG"/>
            <xs:enumeration value="S_BAHN"/>
        </xs:restriction>
    </xs:simpleType>

    <!-- root element -->
    <xs:element name="InputSchedule">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="InputScheduleEntry"/>
            </xs:choice>
            <xs:attribute type="xs:boolean" name="isBasePlan" use="required"/>
            <xs:attribute type="xs:boolean" name="isCurrentPlan" use="required"/>
            <xs:attribute type="xs:boolean" name="clear" use="required"/>
        </xs:complexType>

        <!-- uniqueness requirements -->
        <xs:unique name="unique-InputScheduleEntry-trainIdAtProdDate">
            <xs:selector xpath=".//InputScheduleEntry"/>
            <xs:field xpath="@trainId"/>
            <xs:field xpath="@prodDate"/>
        </xs:unique>
    </xs:element>

    <!-- Children of root -->
    <xs:element name="InputScheduleEntry">
        <xs:complexType>
            <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element ref="PlannedWaypoint"/>
            </xs:choice>
            <xs:attribute type="xs:string" name="trainId" use="required"/>
            <xs:attribute type="xs:string" name="tripShortName" use="optional"/>
            <xs:attribute type="xs:string" name="routeShortName" use="optional"/>
            <!-- The production date is the local date of the railway system.  -->
            <xs:attribute type="xs:date" name="prodDate" use="required"/>
            <xs:attribute type="TrainClassEnum" name="trainClass" use="required"/>
            <xs:attribute type="xs:boolean" name="isReRoutable" use="required"/>
            <!-- The weight is in metric tons. -->
            <xs:attribute type="xs:integer" name="optimizationWeight" use="required"/>
        </xs:complexType>
    </xs:element>
    <!-- Children of InputScheduleEntry -->
    <xs:element name="PlannedWaypoint">
        <xs:complexType>
            <xs:attribute type="xs:string" name="name" use="required"/>
            <xs:attribute type="xs:boolean" name="isStopping" use="required"/>
            <!-- The format of arrivalTime and departureTime is "YYYY-MM-DD@hh:mm:ss".
                   The date part "YYYY-MM-DD" is a repetition of the production date.
                   The time part "hh:mm:ss" is relative to noon of the production date minus 12 hours.
                   The hours part "hh" may be greater than 23 for trains which driver over midnight.
                       -->
            <xs:attribute type="xs:string" name="arrivalTime" use="optional"/>
            <xs:attribute type="xs:string" name="departureTime" use="optional"/>
        </xs:complexType>
    </xs:element>
</xs:schema>
